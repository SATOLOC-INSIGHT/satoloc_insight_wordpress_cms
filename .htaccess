# BEGIN WordPress
# The directives (lines) between "BEGIN WordPress" and "END WordPress" are
# dynamically generated, and should only be modified via WordPress filters.
# Any changes to the directives between these markers will be overwritten.
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>

# END WordPress

# Redirect public blog posts to frontend domain
<IfModule mod_rewrite.c>
    # Only redirect if NOT accessing admin areas, API endpoints, or logged in
    RewriteCond %{REQUEST_URI} !^/wp-admin/
    RewriteCond %{REQUEST_URI} !^/wp-login\.php
    RewriteCond %{REQUEST_URI} !^/wp-json/
    RewriteCond %{REQUEST_URI} !^/xmlrpc\.php
    RewriteCond %{HTTP_COOKIE} !wordpress_logged_in
    
    # Redirect specific blog posts to frontend (handles your exact case)
    RewriteRule ^satoloc-insight-scale-content-multilingual-seo-ai/?$ https://www.satolocinsight.com/blog/satoloc-insight-scale-content-multilingual-seo-ai [R=301,L]
    
    # Redirect all other blog posts to frontend
    RewriteRule ^([^/]+)/?$ https://www.satolocinsight.com/blog/$1 [R=301,L]
    
    # Redirect category and tag pages to frontend blog
    RewriteRule ^category/(.*)$ https://www.satolocinsight.com/blog [R=301,L]
    RewriteRule ^tag/(.*)$ https://www.satolocinsight.com/blog [R=301,L]
    
    # Redirect main blog page to frontend (but allow admin access)
    RewriteCond %{REQUEST_URI} ^/$
    RewriteCond %{HTTP_COOKIE} !wordpress_logged_in
    RewriteRule ^$ https://www.satolocinsight.com/blog [R=301,L]
</IfModule>

# CORS Headers for SatoLOC REST API
<IfModule mod_headers.c>
    # Dynamic CORS origin handling
    SetEnvIf Origin "https://satolocinsight\.com" CORS_ALLOW_ORIGIN=$0
    SetEnvIf Origin "https://www\.satolocinsight\.com" CORS_ALLOW_ORIGIN=$0
    SetEnvIf Origin "http://localhost:3000" CORS_ALLOW_ORIGIN=$0
    SetEnvIf Origin "http://localhost:3001" CORS_ALLOW_ORIGIN=$0
    
    Header always set Access-Control-Allow-Origin %{CORS_ALLOW_ORIGIN}e env=CORS_ALLOW_ORIGIN
    Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS, DELETE, PUT, PATCH"
    Header always set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization, Cache-Control, X-WP-Nonce"
    Header always set Access-Control-Allow-Credentials "true"
    Header always set Access-Control-Expose-Headers "X-WP-Total, X-WP-TotalPages"
    Header always set Access-Control-Max-Age "86400"
    Header always set Vary "Origin"
    
    # Handle preflight OPTIONS requests
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
</IfModule>
